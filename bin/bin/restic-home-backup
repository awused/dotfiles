#!/bin/sh
# ~/bin/restic-home-backup

usbdir=/media/BACKUPS/google_cloud_storage

export TMPDIR=/storage/cache/restic/tmp
export GOOGLE_PROJECT_ID="$(get-automation-password restic-google-project)"
export GOOGLE_APPLICATION_CREDENTIALS=$usbdir/.restic-robot.json


restic \
  -r "$(get-automation-password restic-bucket)" \
  backup \
  --cache-dir=/storage/cache/restic/cache \
  --hostname=desuserver \
  --tag=home \
  --limit-upload=500 \
  --password-file=$usbdir/.restic-password \
  --exclude='*.swp' \
  --exclude='.git' \
  --exclude='.github' \
  --exclude='node_modules' \
  --exclude='$RECYCLE.BIN' \
  --exclude='desktop.ini' \
  --exclude='go/pkg' \
  --exclude='node.core' \
  --exclude-file=$HOME/.restic-exclude \
  --files-from=$HOME/.restic-home-files \
  $@

